<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}DoD Budget Explorer{% endblock %}</title>

  <!-- FALCON-11: Dark mode init extracted to external file -->
  <script src="/static/js/dark-mode.js"></script>

  <!-- FE-009: Meta description and Open Graph tags -->
  <meta name="description" content="Search and explore U.S. Department of Defense budget justification data across fiscal years, services, and appropriation accounts.">
  <meta property="og:title" content="DoD Budget Explorer">
  <meta property="og:description" content="Search and explore U.S. Department of Defense budget justification data across fiscal years, services, and appropriation accounts.">
  <meta property="og:type" content="website">

  <!-- Typography: Space Grotesk (headings), Inter (body), Space Mono (monospace) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

  <!-- FIX-001: Removed incorrect SRI integrity hashes that prevented HTMX and
       Chart.js from loading. Updated to current stable CDN versions. -->
  <!-- HTMX for dynamic page updates without full reloads -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <!-- Chart.js for visualizations -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
  <!-- chartjs-chart-treemap for hierarchical budget breakdowns -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-treemap@2.3.1/dist/chartjs-chart-treemap.min.js"></script>

  <link rel="stylesheet" href="/static/css/main.css">
  {% block extra_head %}{% endblock %}
</head>
<body>

<!-- FE-004: Skip to main content link -->
<a href="#main-content" class="skip-link">Skip to main content</a>

<header class="site-header">
  <div class="container header-inner">
    <a class="site-title" href="/">DoD Budget Explorer</a>
    <nav class="site-nav" aria-label="Main navigation">
      <button class="hamburger" aria-label="Toggle navigation" aria-expanded="false">
        <span class="hamburger-bar"></span>
        <span class="hamburger-bar"></span>
        <span class="hamburger-bar"></span>
      </button>
      <!-- FALCON-7: Nav order â€” Home > Search > Charts > Programs > About > API Docs -->
      <div class="nav-links">
        <a href="/"          {% if request.url.path == "/" %}class="active"{% endif %}>Home</a>
        <a href="/dashboard" {% if request.url.path == "/dashboard" %}class="active"{% endif %}>Dashboard</a>
        <a href="/charts"    {% if request.url.path == "/charts" %}class="active"{% endif %}>Charts</a>
        <a href="/programs"  {% if request.url.path.startswith("/programs") %}class="active"{% endif %}>Programs</a>
        <a href="/about"     {% if request.url.path == "/about" or request.url.path == "/glossary" %}class="active"{% endif %}>About</a>
        <a href="/docs"      target="_blank" rel="noopener">API Docs</a>
      </div>
      <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
        <span class="icon-moon">&#9790;</span>
        <span class="icon-sun">&#9788;</span>
      </button>
    </nav>
  </div>
</header>

<main id="main-content" class="container main-content" tabindex="-1">
  {% block content %}{% endblock %}
</main>

<!-- FALCON-7: Enhanced footer with metadata -->
<footer class="site-footer">
  <div class="container footer-content">
    <div class="footer-main">
      Data sourced from <a href="https://comptroller.defense.gov/Budget-Materials/" target="_blank"
        rel="noopener">DoD Comptroller</a>.
      This is an independent research tool; not affiliated with the U.S. Department of Defense.
    </div>
    <div class="footer-meta" id="footer-meta">
      <!-- Populated via /api/v1/metadata by FALCON-7 JS -->
    </div>
    <div class="footer-links">
      <a href="/about">About</a>
      <a href="/about#glossary">Glossary</a>
      <a href="/docs" target="_blank" rel="noopener">API</a>
      <button class="btn btn-secondary btn-sm feedback-btn" onclick="openFeedbackModal()" aria-label="Send feedback">Feedback</button>
    </div>
  </div>
</footer>

<!-- DONE [Group: LION] LION-002: Feedback form modal -->
{% include "partials/feedback.html" %}

<!-- Toast notification container -->
<div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

<!-- Back to top button -->
<button id="back-to-top" class="back-to-top" aria-label="Back to top"
        onclick="window.scrollTo({top:0,behavior:'smooth'})">&#8593;</button>

<script src="/static/js/checkbox-select.js"></script>
<!-- FALCON-10: Toast notification component -->
{% include "partials/toast.html" %}

{% block extra_scripts %}{% endblock %}
</body>
</html>
